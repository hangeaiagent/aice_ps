# 🚨 修复406错误 - 立即执行指南

## 当前问题
```
GET https://uobwbhvwrciaxloqdizc.supabase.co/rest/v1/pay_user_subscriptions?... 406 (Not Acceptable)
```

## 🔧 立即修复步骤

### 步骤1：登录Supabase Dashboard
1. 访问：https://supabase.com/dashboard
2. 选择您的项目：`uobwbhvwrciaxloqdizc`
3. 点击左侧菜单的 "SQL Editor"

### 步骤2：执行修复脚本
复制以下SQL代码并在SQL Editor中执行：

```sql
-- 快速修复406错误
ALTER TABLE public.pay_subscription_plans ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.pay_user_subscriptions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.pay_user_credits ENABLE ROW LEVEL SECURITY;

-- 删除现有策略
DROP POLICY IF EXISTS "pay_subscription_plans_read_policy" ON public.pay_subscription_plans;
DROP POLICY IF EXISTS "pay_user_subscriptions_read_policy" ON public.pay_user_subscriptions;
DROP POLICY IF EXISTS "pay_user_credits_read_policy" ON public.pay_user_credits;

-- 创建新策略
CREATE POLICY "allow_read_plans" ON public.pay_subscription_plans
    FOR SELECT TO public USING (true);

CREATE POLICY "allow_read_own_subscriptions" ON public.pay_user_subscriptions
    FOR SELECT TO authenticated USING (auth.uid() = user_id);

CREATE POLICY "allow_read_own_credits" ON public.pay_user_credits
    FOR SELECT TO authenticated USING (auth.uid() = user_id);

-- 确保套餐数据存在
INSERT INTO public.pay_subscription_plans (plan_code, plan_name, plan_name_en, price_monthly, price_yearly, credits_monthly, features, is_active, sort_order) VALUES
('free', '免费版', 'Free', 0.00, 0.00, 0, '{"nano_banana": false}', true, 1),
('starter', '入门版', 'Starter', 6.90, 69.00, 560, '{"nano_banana": true}', true, 2),
('advanced', '进阶版', 'Advanced', 19.90, 199.00, 1680, '{"nano_banana": true}', true, 3),
('professional', '专业版', 'Professional', 29.90, 299.00, 4200, '{"nano_banana": true}', true, 4),
('lifetime', '买断版', 'Lifetime', 399.00, 399.00, 4200, '{"nano_banana": true}', true, 5)
ON CONFLICT (plan_code) DO UPDATE SET
  plan_name = EXCLUDED.plan_name,
  price_monthly = EXCLUDED.price_monthly,
  credits_monthly = EXCLUDED.credits_monthly;

-- 为现有用户创建积分记录
INSERT INTO public.pay_user_credits (user_id, total_credits, used_credits, available_credits, monthly_quota, quota_reset_date)
SELECT id, 100, 0, 100, 100, NOW() + INTERVAL '1 month'
FROM auth.users
WHERE id NOT IN (SELECT user_id FROM public.pay_user_credits WHERE user_id IS NOT NULL)
ON CONFLICT (user_id) DO NOTHING;
```

### 步骤3：验证修复
执行完成后，刷新网页：https://nanobanana.gitagent.io/pricing

## ✅ 预期结果
- 价格页面正常显示
- 不再出现406错误
- PayPal支付按钮可以正常点击

## 🆘 如果仍有问题
1. 检查SQL执行是否有错误信息
2. 确认您有项目的管理员权限
3. 联系技术支持

---
**重要**：请立即执行上述SQL脚本以修复406错误！
