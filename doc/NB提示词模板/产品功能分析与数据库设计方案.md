# NB提示词模板库 - 产品功能分析与数据库设计方案

## 1. 当前产品功能分析

### 1.1 现有功能概述
基于代码分析，当前 AicePS 项目中的提示词模板功能包括：

#### 核心功能
- **模板展示**: 网格布局展示模板卡片
- **模板搜索**: 支持按名称、描述、提示词内容搜索
- **模板分页**: 每页显示9个模板
- **模板预览**: 点击模板查看详细信息
- **模板应用**: 复制提示词到剪贴板，加载到编辑器

#### 数据结构
```typescript
interface Template {
  id: string;           // 模板唯一标识
  name: string;         // 模板名称
  iconUrl: string;      // 图标URL
  baseUrl: string;      // 基础图片URL
  description: string;  // 模板描述
  prompt: string;       // 提示词内容
}
```

#### 存储方式
- 当前使用静态 JSON 文件 (`templates.json`)
- 包含4个预设模板：热门手办、旧照片修复、PVC玩具、软装设计师

### 1.2 功能局限性
1. **静态数据**: 无法动态添加、编辑、删除模板
2. **无用户管理**: 不支持用户个人模板库
3. **无分类管理**: 缺少模板分类和标签系统
4. **无统计分析**: 无使用量、热度等数据统计
5. **无审核机制**: 无内容审核和质量控制
6. **无版本控制**: 无模板版本管理和历史记录

## 2. 升级方案：NB提示词模板库

### 2.1 产品定位
打造一个**智能化、社区化、专业化**的提示词模板平台：
- **智能化**: AI辅助生成和优化提示词
- **社区化**: 用户共创、分享、评价模板
- **专业化**: 分类管理、质量控制、数据分析

### 2.2 核心功能升级

#### 用户端功能
1. **模板浏览与搜索**
   - 多维度搜索（关键词、分类、标签、作者）
   - 智能推荐算法
   - 热门排行榜
   - 收藏夹管理

2. **模板创建与管理**
   - 从用户任务历史中一键发布模板
   - 可视化模板编辑器
   - 模板预览和测试
   - 版本管理和更新

3. **社区互动**
   - 模板评分和评论
   - 使用统计和反馈
   - 作者关注和私信
   - 模板分享和推广

#### 管理端功能
1. **内容管理**
   - 模板审核和发布
   - 分类和标签管理
   - 质量评估和优化建议
   - 违规内容处理

2. **用户管理**
   - 用户权限控制
   - 创作者认证
   - 活跃度分析
   - 奖励机制管理

3. **数据分析**
   - 使用量统计
   - 热门趋势分析
   - 用户行为分析
   - 收益分析报告

## 3. 数据库设计方案

### 3.1 数据库架构

#### 核心表结构

##### 3.1.1 用户相关表

```sql
-- 用户扩展信息表
CREATE TABLE nb_user_profiles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    username VARCHAR(50) UNIQUE NOT NULL,
    avatar_url TEXT,
    bio TEXT,
    is_creator BOOLEAN DEFAULT false,
    creator_level INTEGER DEFAULT 1, -- 1:新手, 2:进阶, 3:专家, 4:大师
    total_templates INTEGER DEFAULT 0,
    total_downloads INTEGER DEFAULT 0,
    total_likes INTEGER DEFAULT 0,
    reputation_score INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 用户关注关系表
CREATE TABLE nb_user_follows (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    follower_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    following_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(follower_id, following_id)
);
```

##### 3.1.2 分类和标签表

```sql
-- 模板分类表
CREATE TABLE nb_template_categories (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    name_en VARCHAR(100),
    description TEXT,
    icon_url TEXT,
    parent_id UUID REFERENCES nb_template_categories(id),
    sort_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 模板标签表
CREATE TABLE nb_template_tags (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(50) NOT NULL UNIQUE,
    color VARCHAR(7) DEFAULT '#3B82F6', -- 标签颜色
    usage_count INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

##### 3.1.3 模板核心表

```sql
-- 模板主表
CREATE TABLE nb_templates (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(200) NOT NULL,
    description TEXT,
    prompt TEXT NOT NULL,
    
    -- 作者信息
    author_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    
    -- 分类信息
    category_id UUID REFERENCES nb_template_categories(id),
    
    -- 媒体资源
    cover_image_url TEXT,
    example_images TEXT[], -- 示例图片数组
    
    -- 模板属性
    difficulty_level INTEGER DEFAULT 1, -- 1:简单, 2:中等, 3:困难
    estimated_time INTEGER, -- 预估使用时间(分钟)
    
    -- 状态管理
    status VARCHAR(20) DEFAULT 'draft', -- draft, pending, published, rejected, archived
    is_featured BOOLEAN DEFAULT false,
    is_premium BOOLEAN DEFAULT false,
    
    -- 统计数据
    view_count INTEGER DEFAULT 0,
    download_count INTEGER DEFAULT 0,
    like_count INTEGER DEFAULT 0,
    comment_count INTEGER DEFAULT 0,
    rating_avg DECIMAL(3,2) DEFAULT 0.00,
    rating_count INTEGER DEFAULT 0,
    
    -- 版本控制
    version VARCHAR(10) DEFAULT '1.0',
    parent_template_id UUID REFERENCES nb_templates(id), -- 用于版本管理
    
    -- 审核信息
    reviewed_by UUID REFERENCES auth.users(id),
    reviewed_at TIMESTAMP WITH TIME ZONE,
    review_notes TEXT,
    
    -- 时间戳
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    published_at TIMESTAMP WITH TIME ZONE
);

-- 模板标签关联表
CREATE TABLE nb_template_tag_relations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    template_id UUID REFERENCES nb_templates(id) ON DELETE CASCADE,
    tag_id UUID REFERENCES nb_template_tags(id) ON DELETE CASCADE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(template_id, tag_id)
);

-- 模板版本历史表
CREATE TABLE nb_template_versions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    template_id UUID REFERENCES nb_templates(id) ON DELETE CASCADE,
    version VARCHAR(10) NOT NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    prompt TEXT NOT NULL,
    cover_image_url TEXT,
    change_log TEXT,
    created_by UUID REFERENCES auth.users(id),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

##### 3.1.4 用户互动表

```sql
-- 用户收藏表
CREATE TABLE nb_user_favorites (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    template_id UUID REFERENCES nb_templates(id) ON DELETE CASCADE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, template_id)
);

-- 用户点赞表
CREATE TABLE nb_user_likes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    template_id UUID REFERENCES nb_templates(id) ON DELETE CASCADE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, template_id)
);

-- 用户评分表
CREATE TABLE nb_user_ratings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    template_id UUID REFERENCES nb_templates(id) ON DELETE CASCADE,
    rating INTEGER CHECK (rating >= 1 AND rating <= 5),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, template_id)
);

-- 用户评论表
CREATE TABLE nb_user_comments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    template_id UUID REFERENCES nb_templates(id) ON DELETE CASCADE,
    parent_comment_id UUID REFERENCES nb_user_comments(id), -- 支持回复
    content TEXT NOT NULL,
    is_deleted BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 模板使用记录表
CREATE TABLE nb_template_usage_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    template_id UUID REFERENCES nb_templates(id) ON DELETE CASCADE,
    action VARCHAR(20) NOT NULL, -- view, download, use, share
    ip_address INET,
    user_agent TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

##### 3.1.5 任务和发布表

```sql
-- 用户任务历史表（从现有系统扩展）
CREATE TABLE nb_user_tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    original_image_url TEXT,
    processed_image_url TEXT,
    prompt TEXT NOT NULL,
    task_type VARCHAR(50), -- image_edit, style_transfer, etc.
    parameters JSONB, -- 存储任务参数
    is_successful BOOLEAN DEFAULT false,
    processing_time INTEGER, -- 处理时间(秒)
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 从任务发布模板的申请表
CREATE TABLE nb_template_publish_requests (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    task_id UUID REFERENCES nb_user_tasks(id),
    proposed_title VARCHAR(200) NOT NULL,
    proposed_description TEXT,
    proposed_category_id UUID REFERENCES nb_template_categories(id),
    proposed_tags TEXT[], -- 建议标签
    status VARCHAR(20) DEFAULT 'pending', -- pending, approved, rejected
    admin_notes TEXT,
    processed_by UUID REFERENCES auth.users(id),
    processed_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 3.2 索引设计

```sql
-- 性能优化索引
CREATE INDEX idx_nb_templates_author_id ON nb_templates(author_id);
CREATE INDEX idx_nb_templates_category_id ON nb_templates(category_id);
CREATE INDEX idx_nb_templates_status ON nb_templates(status);
CREATE INDEX idx_nb_templates_created_at ON nb_templates(created_at DESC);
CREATE INDEX idx_nb_templates_download_count ON nb_templates(download_count DESC);
CREATE INDEX idx_nb_templates_like_count ON nb_templates(like_count DESC);
CREATE INDEX idx_nb_templates_rating_avg ON nb_templates(rating_avg DESC);

-- 搜索优化索引
CREATE INDEX idx_nb_templates_title_search ON nb_templates USING gin(to_tsvector('english', title));
CREATE INDEX idx_nb_templates_description_search ON nb_templates USING gin(to_tsvector('english', description));
CREATE INDEX idx_nb_templates_prompt_search ON nb_templates USING gin(to_tsvector('english', prompt));

-- 用户相关索引
CREATE INDEX idx_nb_user_favorites_user_id ON nb_user_favorites(user_id);
CREATE INDEX idx_nb_user_likes_template_id ON nb_user_likes(template_id);
CREATE INDEX idx_nb_template_usage_logs_template_id ON nb_template_usage_logs(template_id);
CREATE INDEX idx_nb_template_usage_logs_created_at ON nb_template_usage_logs(created_at);
```

### 3.3 数据库触发器和函数

```sql
-- 更新模板统计数据的触发器函数
CREATE OR REPLACE FUNCTION update_template_stats()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_TABLE_NAME = 'nb_user_likes' THEN
        IF TG_OP = 'INSERT' THEN
            UPDATE nb_templates 
            SET like_count = like_count + 1 
            WHERE id = NEW.template_id;
        ELSIF TG_OP = 'DELETE' THEN
            UPDATE nb_templates 
            SET like_count = like_count - 1 
            WHERE id = OLD.template_id;
        END IF;
    ELSIF TG_TABLE_NAME = 'nb_user_comments' THEN
        IF TG_OP = 'INSERT' AND NOT NEW.is_deleted THEN
            UPDATE nb_templates 
            SET comment_count = comment_count + 1 
            WHERE id = NEW.template_id;
        ELSIF TG_OP = 'UPDATE' THEN
            IF OLD.is_deleted = false AND NEW.is_deleted = true THEN
                UPDATE nb_templates 
                SET comment_count = comment_count - 1 
                WHERE id = NEW.template_id;
            ELSIF OLD.is_deleted = true AND NEW.is_deleted = false THEN
                UPDATE nb_templates 
                SET comment_count = comment_count + 1 
                WHERE id = NEW.template_id;
            END IF;
        END IF;
    ELSIF TG_TABLE_NAME = 'nb_user_ratings' THEN
        -- 重新计算平均评分
        UPDATE nb_templates 
        SET 
            rating_avg = (
                SELECT COALESCE(AVG(rating), 0) 
                FROM nb_user_ratings 
                WHERE template_id = COALESCE(NEW.template_id, OLD.template_id)
            ),
            rating_count = (
                SELECT COUNT(*) 
                FROM nb_user_ratings 
                WHERE template_id = COALESCE(NEW.template_id, OLD.template_id)
            )
        WHERE id = COALESCE(NEW.template_id, OLD.template_id);
    END IF;
    
    RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql;

-- 创建触发器
CREATE TRIGGER trigger_update_template_likes
    AFTER INSERT OR DELETE ON nb_user_likes
    FOR EACH ROW EXECUTE FUNCTION update_template_stats();

CREATE TRIGGER trigger_update_template_comments
    AFTER INSERT OR UPDATE ON nb_user_comments
    FOR EACH ROW EXECUTE FUNCTION update_template_stats();

CREATE TRIGGER trigger_update_template_ratings
    AFTER INSERT OR UPDATE OR DELETE ON nb_user_ratings
    FOR EACH ROW EXECUTE FUNCTION update_template_stats();
```

## 4. API接口设计

### 4.1 模板相关接口

#### 4.1.1 模板查询接口

```javascript
// GET /api/templates
// 查询模板列表
{
  "method": "GET",
  "path": "/api/templates",
  "query": {
    "page": 1,
    "limit": 20,
    "category": "uuid",
    "tags": ["tag1", "tag2"],
    "search": "关键词",
    "sort": "popular|latest|rating|downloads",
    "author": "uuid",
    "featured": true,
    "premium": false
  },
  "response": {
    "success": true,
    "data": {
      "templates": [...],
      "total": 100,
      "page": 1,
      "limit": 20,
      "hasMore": true
    }
  }
}

// GET /api/templates/:id
// 获取模板详情
{
  "method": "GET",
  "path": "/api/templates/:id",
  "response": {
    "success": true,
    "data": {
      "template": {
        "id": "uuid",
        "title": "模板标题",
        "description": "模板描述",
        "prompt": "提示词内容",
        "author": {
          "id": "uuid",
          "username": "作者名",
          "avatar_url": "头像URL"
        },
        "category": {
          "id": "uuid",
          "name": "分类名称"
        },
        "tags": [...],
        "stats": {
          "view_count": 1000,
          "download_count": 500,
          "like_count": 200,
          "rating_avg": 4.5,
          "rating_count": 100
        },
        "user_interaction": {
          "is_liked": false,
          "is_favorited": true,
          "user_rating": 5
        }
      }
    }
  }
}
```

#### 4.1.2 模板管理接口

```javascript
// POST /api/templates
// 创建模板
{
  "method": "POST",
  "path": "/api/templates",
  "body": {
    "title": "模板标题",
    "description": "模板描述",
    "prompt": "提示词内容",
    "category_id": "uuid",
    "tags": ["tag1", "tag2"],
    "cover_image": "base64 or file",
    "example_images": ["base64 or file"],
    "difficulty_level": 2,
    "estimated_time": 30
  },
  "response": {
    "success": true,
    "data": {
      "template_id": "uuid",
      "status": "pending"
    }
  }
}

// PUT /api/templates/:id
// 更新模板
{
  "method": "PUT",
  "path": "/api/templates/:id",
  "body": {
    "title": "新标题",
    "description": "新描述",
    "version": "1.1",
    "change_log": "更新说明"
  }
}

// DELETE /api/templates/:id
// 删除模板
{
  "method": "DELETE",
  "path": "/api/templates/:id"
}
```

#### 4.1.3 用户互动接口

```javascript
// POST /api/templates/:id/like
// 点赞/取消点赞
{
  "method": "POST",
  "path": "/api/templates/:id/like",
  "response": {
    "success": true,
    "data": {
      "is_liked": true,
      "like_count": 201
    }
  }
}

// POST /api/templates/:id/favorite
// 收藏/取消收藏
{
  "method": "POST",
  "path": "/api/templates/:id/favorite"
}

// POST /api/templates/:id/rating
// 评分
{
  "method": "POST",
  "path": "/api/templates/:id/rating",
  "body": {
    "rating": 5
  }
}

// GET /api/templates/:id/comments
// 获取评论
{
  "method": "GET",
  "path": "/api/templates/:id/comments",
  "query": {
    "page": 1,
    "limit": 20
  }
}

// POST /api/templates/:id/comments
// 添加评论
{
  "method": "POST",
  "path": "/api/templates/:id/comments",
  "body": {
    "content": "评论内容",
    "parent_comment_id": "uuid" // 可选，用于回复
  }
}
```

### 4.2 任务发布接口

```javascript
// GET /api/user/tasks
// 获取用户任务历史
{
  "method": "GET",
  "path": "/api/user/tasks",
  "query": {
    "page": 1,
    "limit": 20,
    "successful_only": true
  },
  "response": {
    "success": true,
    "data": {
      "tasks": [
        {
          "id": "uuid",
          "original_image_url": "图片URL",
          "processed_image_url": "处理后图片URL",
          "prompt": "使用的提示词",
          "task_type": "image_edit",
          "is_successful": true,
          "created_at": "2024-01-01T00:00:00Z",
          "can_publish": true // 是否可以发布为模板
        }
      ]
    }
  }
}

// POST /api/templates/publish-from-task
// 从任务发布模板
{
  "method": "POST",
  "path": "/api/templates/publish-from-task",
  "body": {
    "task_id": "uuid",
    "title": "模板标题",
    "description": "模板描述",
    "category_id": "uuid",
    "tags": ["tag1", "tag2"]
  },
  "response": {
    "success": true,
    "data": {
      "request_id": "uuid",
      "status": "pending",
      "message": "发布申请已提交，等待审核"
    }
  }
}
```

### 4.3 管理后台接口

```javascript
// GET /api/admin/templates/pending
// 获取待审核模板
{
  "method": "GET",
  "path": "/api/admin/templates/pending",
  "headers": {
    "Authorization": "Bearer admin_token"
  }
}

// POST /api/admin/templates/:id/review
// 审核模板
{
  "method": "POST",
  "path": "/api/admin/templates/:id/review",
  "body": {
    "action": "approve|reject",
    "notes": "审核意见"
  }
}

// GET /api/admin/analytics/templates
// 模板数据分析
{
  "method": "GET",
  "path": "/api/admin/analytics/templates",
  "query": {
    "period": "7d|30d|90d",
    "metric": "views|downloads|likes|ratings"
  }
}
```

## 5. 前端开发方案

### 5.1 组件架构

```typescript
// 核心类型定义
interface Template {
  id: string;
  title: string;
  description: string;
  prompt: string;
  author: {
    id: string;
    username: string;
    avatar_url: string;
  };
  category: {
    id: string;
    name: string;
  };
  tags: Tag[];
  cover_image_url: string;
  example_images: string[];
  stats: {
    view_count: number;
    download_count: number;
    like_count: number;
    rating_avg: number;
    rating_count: number;
  };
  user_interaction?: {
    is_liked: boolean;
    is_favorited: boolean;
    user_rating?: number;
  };
  created_at: string;
  updated_at: string;
}

interface Category {
  id: string;
  name: string;
  name_en: string;
  description: string;
  icon_url: string;
  parent_id?: string;
  children?: Category[];
}

interface Tag {
  id: string;
  name: string;
  color: string;
  usage_count: number;
}
```

### 5.2 主要组件

#### 5.2.1 模板库主页组件

```typescript
// components/TemplateLibrary/TemplateLibraryPage.tsx
interface TemplateLibraryPageProps {
  onTemplateSelect: (template: Template) => void;
}

const TemplateLibraryPage: React.FC<TemplateLibraryPageProps> = ({
  onTemplateSelect
}) => {
  const [templates, setTemplates] = useState<Template[]>([]);
  const [categories, setCategories] = useState<Category[]>([]);
  const [selectedCategory, setSelectedCategory] = useState<string>('');
  const [searchQuery, setSearchQuery] = useState('');
  const [sortBy, setSortBy] = useState<'popular' | 'latest' | 'rating'>('popular');
  const [currentPage, setCurrentPage] = useState(1);
  const [loading, setLoading] = useState(false);

  // 搜索和筛选逻辑
  const fetchTemplates = useCallback(async () => {
    setLoading(true);
    try {
      const response = await templateAPI.getTemplates({
        page: currentPage,
        limit: 20,
        category: selectedCategory,
        search: searchQuery,
        sort: sortBy
      });
      setTemplates(response.data.templates);
    } catch (error) {
      console.error('Failed to fetch templates:', error);
    } finally {
      setLoading(false);
    }
  }, [currentPage, selectedCategory, searchQuery, sortBy]);

  return (
    <div className="template-library">
      {/* 搜索和筛选栏 */}
      <TemplateSearchBar
        searchQuery={searchQuery}
        onSearchChange={setSearchQuery}
        categories={categories}
        selectedCategory={selectedCategory}
        onCategoryChange={setSelectedCategory}
        sortBy={sortBy}
        onSortChange={setSortBy}
      />
      
      {/* 模板网格 */}
      <TemplateGrid
        templates={templates}
        loading={loading}
        onTemplateSelect={onTemplateSelect}
      />
      
      {/* 分页 */}
      <Pagination
        currentPage={currentPage}
        onPageChange={setCurrentPage}
      />
    </div>
  );
};
```

#### 5.2.2 模板卡片组件

```typescript
// components/TemplateLibrary/TemplateCard.tsx
interface TemplateCardProps {
  template: Template;
  onSelect: (template: Template) => void;
  onLike?: (templateId: string) => void;
  onFavorite?: (templateId: string) => void;
}

const TemplateCard: React.FC<TemplateCardProps> = ({
  template,
  onSelect,
  onLike,
  onFavorite
}) => {
  const handleLike = async (e: React.MouseEvent) => {
    e.stopPropagation();
    try {
      await templateAPI.toggleLike(template.id);
      onLike?.(template.id);
    } catch (error) {
      console.error('Failed to like template:', error);
    }
  };

  return (
    <div 
      className="template-card"
      onClick={() => onSelect(template)}
    >
      {/* 封面图片 */}
      <div className="template-cover">
        <img 
          src={template.cover_image_url} 
          alt={template.title}
          className="cover-image"
        />
        <div className="template-overlay">
          <button 
            className="like-button"
            onClick={handleLike}
          >
            <HeartIcon filled={template.user_interaction?.is_liked} />
            {template.stats.like_count}
          </button>
        </div>
      </div>
      
      {/* 模板信息 */}
      <div className="template-info">
        <h3 className="template-title">{template.title}</h3>
        <p className="template-description">{template.description}</p>
        
        {/* 标签 */}
        <div className="template-tags">
          {template.tags.map(tag => (
            <span 
              key={tag.id}
              className="tag"
              style={{ backgroundColor: tag.color }}
            >
              {tag.name}
            </span>
          ))}
        </div>
        
        {/* 作者和统计 */}
        <div className="template-meta">
          <div className="author">
            <img 
              src={template.author.avatar_url} 
              alt={template.author.username}
              className="author-avatar"
            />
            <span>{template.author.username}</span>
          </div>
          
          <div className="stats">
            <span>
              <DownloadIcon />
              {template.stats.download_count}
            </span>
            <span>
              <StarIcon />
              {template.stats.rating_avg.toFixed(1)}
            </span>
          </div>
        </div>
      </div>
    </div>
  );
};
```

#### 5.2.3 模板详情页组件

```typescript
// components/TemplateLibrary/TemplateDetailPage.tsx
interface TemplateDetailPageProps {
  templateId: string;
  onUseTemplate: (template: Template) => void;
  onBack: () => void;
}

const TemplateDetailPage: React.FC<TemplateDetailPageProps> = ({
  templateId,
  onUseTemplate,
  onBack
}) => {
  const [template, setTemplate] = useState<Template | null>(null);
  const [comments, setComments] = useState<Comment[]>([]);
  const [newComment, setNewComment] = useState('');
  const [userRating, setUserRating] = useState(0);

  useEffect(() => {
    fetchTemplateDetail();
    fetchComments();
  }, [templateId]);

  const fetchTemplateDetail = async () => {
    try {
      const response = await templateAPI.getTemplate(templateId);
      setTemplate(response.data.template);
      setUserRating(response.data.template.user_interaction?.user_rating || 0);
    } catch (error) {
      console.error('Failed to fetch template detail:', error);
    }
  };

  const handleRating = async (rating: number) => {
    try {
      await templateAPI.rateTemplate(templateId, rating);
      setUserRating(rating);
      // 更新模板评分
      fetchTemplateDetail();
    } catch (error) {
      console.error('Failed to rate template:', error);
    }
  };

  const handleAddComment = async () => {
    if (!newComment.trim()) return;
    
    try {
      await templateAPI.addComment(templateId, newComment);
      setNewComment('');
      fetchComments();
    } catch (error) {
      console.error('Failed to add comment:', error);
    }
  };

  if (!template) return <div>Loading...</div>;

  return (
    <div className="template-detail">
      {/* 头部 */}
      <div className="detail-header">
        <button onClick={onBack} className="back-button">
          <ArrowLeftIcon />
          返回
        </button>
        
        <div className="template-actions">
          <button 
            className="use-template-button"
            onClick={() => onUseTemplate(template)}
          >
            使用此模板
          </button>
        </div>
      </div>
      
      {/* 模板信息 */}
      <div className="template-content">
        <div className="template-images">
          <img 
            src={template.cover_image_url}
            alt={template.title}
            className="main-image"
          />
          
          {template.example_images.length > 0 && (
            <div className="example-images">
              {template.example_images.map((url, index) => (
                <img key={index} src={url} alt={`示例 ${index + 1}`} />
              ))}
            </div>
          )}
        </div>
        
        <div className="template-info">
          <h1>{template.title}</h1>
          <p>{template.description}</p>
          
          {/* 提示词 */}
          <div className="prompt-section">
            <h3>提示词</h3>
            <div className="prompt-content">
              <pre>{template.prompt}</pre>
              <button 
                onClick={() => navigator.clipboard.writeText(template.prompt)}
                className="copy-button"
              >
                复制
              </button>
            </div>
          </div>
          
          {/* 评分 */}
          <div className="rating-section">
            <h3>评分</h3>
            <StarRating
              rating={userRating}
              onRatingChange={handleRating}
            />
            <div className="rating-stats">
              平均评分: {template.stats.rating_avg.toFixed(1)} 
              ({template.stats.rating_count} 人评价)
            </div>
          </div>
        </div>
      </div>
      
      {/* 评论区 */}
      <div className="comments-section">
        <h3>评论 ({template.stats.comment_count})</h3>
        
        <div className="add-comment">
          <textarea
            value={newComment}
            onChange={(e) => setNewComment(e.target.value)}
            placeholder="写下你的评论..."
          />
          <button onClick={handleAddComment}>发表评论</button>
        </div>
        
        <div className="comments-list">
          {comments.map(comment => (
            <CommentItem key={comment.id} comment={comment} />
          ))}
        </div>
      </div>
    </div>
  );
};
```

#### 5.2.4 模板创建/编辑组件

```typescript
// components/TemplateLibrary/TemplateEditor.tsx
interface TemplateEditorProps {
  template?: Template; // 编辑时传入
  taskId?: string; // 从任务创建时传入
  onSave: (template: Partial<Template>) => void;
  onCancel: () => void;
}

const TemplateEditor: React.FC<TemplateEditorProps> = ({
  template,
  taskId,
  onSave,
  onCancel
}) => {
  const [formData, setFormData] = useState({
    title: template?.title || '',
    description: template?.description || '',
    prompt: template?.prompt || '',
    category_id: template?.category?.id || '',
    tags: template?.tags?.map(t => t.name) || [],
    difficulty_level: template?.difficulty_level || 1,
    estimated_time: template?.estimated_time || 30
  });
  
  const [coverImage, setCoverImage] = useState<File | null>(null);
  const [exampleImages, setExampleImages] = useState<File[]>([]);
  const [categories, setCategories] = useState<Category[]>([]);
  const [availableTags, setAvailableTags] = useState<Tag[]>([]);

  useEffect(() => {
    fetchCategories();
    fetchTags();
    
    // 如果是从任务创建，获取任务数据
    if (taskId) {
      fetchTaskData();
    }
  }, [taskId]);

  const fetchTaskData = async () => {
    try {
      const response = await taskAPI.getTask(taskId);
      const task = response.data.task;
      
      setFormData(prev => ({
        ...prev,
        prompt: task.prompt,
        // 可以根据任务类型自动设置分类
        category_id: getCategoryByTaskType(task.task_type)
      }));
    } catch (error) {
      console.error('Failed to fetch task data:', error);
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    try {
      const templateData = {
        ...formData,
        cover_image: coverImage,
        example_images: exampleImages,
        task_id: taskId // 如果是从任务创建
      };
      
      await onSave(templateData);
    } catch (error) {
      console.error('Failed to save template:', error);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="template-editor">
      <div className="editor-header">
        <h2>{template ? '编辑模板' : '创建模板'}</h2>
        <div className="actions">
          <button type="button" onClick={onCancel}>取消</button>
          <button type="submit">保存</button>
        </div>
      </div>
      
      <div className="editor-content">
        {/* 基本信息 */}
        <div className="section">
          <h3>基本信息</h3>
          
          <div className="form-group">
            <label>模板标题</label>
            <input
              type="text"
              value={formData.title}
              onChange={(e) => setFormData(prev => ({
                ...prev,
                title: e.target.value
              }))}
              required
            />
          </div>
          
          <div className="form-group">
            <label>模板描述</label>
            <textarea
              value={formData.description}
              onChange={(e) => setFormData(prev => ({
                ...prev,
                description: e.target.value
              }))}
              rows={3}
            />
          </div>
          
          <div className="form-group">
            <label>分类</label>
            <select
              value={formData.category_id}
              onChange={(e) => setFormData(prev => ({
                ...prev,
                category_id: e.target.value
              }))}
              required
            >
              <option value="">请选择分类</option>
              {categories.map(category => (
                <option key={category.id} value={category.id}>
                  {category.name}
                </option>
              ))}
            </select>
          </div>
          
          <div className="form-group">
            <label>标签</label>
            <TagSelector
              availableTags={availableTags}
              selectedTags={formData.tags}
              onTagsChange={(tags) => setFormData(prev => ({
                ...prev,
                tags
              }))}
            />
          </div>
        </div>
        
        {/* 提示词 */}
        <div className="section">
          <h3>提示词内容</h3>
          <div className="form-group">
            <textarea
              value={formData.prompt}
              onChange={(e) => setFormData(prev => ({
                ...prev,
                prompt: e.target.value
              }))}
              rows={8}
              placeholder="输入提示词内容..."
              required
            />
          </div>
        </div>
        
        {/* 图片上传 */}
        <div className="section">
          <h3>图片资源</h3>
          
          <div className="form-group">
            <label>封面图片</label>
            <ImageUploader
              onImageSelect={setCoverImage}
              preview={template?.cover_image_url}
            />
          </div>
          
          <div className="form-group">
            <label>示例图片</label>
            <MultiImageUploader
              onImagesSelect={setExampleImages}
              previews={template?.example_images}
            />
          </div>
        </div>
        
        {/* 其他设置 */}
        <div className="section">
          <h3>其他设置</h3>
          
          <div className="form-group">
            <label>难度等级</label>
            <select
              value={formData.difficulty_level}
              onChange={(e) => setFormData(prev => ({
                ...prev,
                difficulty_level: parseInt(e.target.value)
              }))}
            >
              <option value={1}>简单</option>
              <option value={2}>中等</option>
              <option value={3}>困难</option>
            </select>
          </div>
          
          <div className="form-group">
            <label>预估使用时间（分钟）</label>
            <input
              type="number"
              value={formData.estimated_time}
              onChange={(e) => setFormData(prev => ({
                ...prev,
                estimated_time: parseInt(e.target.value)
              }))}
              min={1}
              max={180}
            />
          </div>
        </div>
      </div>
    </form>
  );
};
```

### 5.3 状态管理

```typescript
// stores/templateStore.ts
interface TemplateState {
  templates: Template[];
  categories: Category[];
  tags: Tag[];
  currentTemplate: Template | null;
  favorites: string[];
  searchQuery: string;
  selectedCategory: string;
  sortBy: 'popular' | 'latest' | 'rating';
  loading: boolean;
  error: string | null;
}

const useTemplateStore = create<TemplateState>((set, get) => ({
  templates: [],
  categories: [],
  tags: [],
  currentTemplate: null,
  favorites: [],
  searchQuery: '',
  selectedCategory: '',
  sortBy: 'popular',
  loading: false,
  error: null,

  // Actions
  fetchTemplates: async (params: TemplateQueryParams) => {
    set({ loading: true, error: null });
    try {
      const response = await templateAPI.getTemplates(params);
      set({ 
        templates: response.data.templates,
        loading: false 
      });
    } catch (error) {
      set({ 
        error: error.message,
        loading: false 
      });
    }
  },

  setSearchQuery: (query: string) => {
    set({ searchQuery: query });
  },

  setSelectedCategory: (categoryId: string) => {
    set({ selectedCategory: categoryId });
  },

  toggleFavorite: async (templateId: string) => {
    try {
      await templateAPI.toggleFavorite(templateId);
      const favorites = get().favorites;
      const newFavorites = favorites.includes(templateId)
        ? favorites.filter(id => id !== templateId)
        : [...favorites, templateId];
      set({ favorites: newFavorites });
    } catch (error) {
      console.error('Failed to toggle favorite:', error);
    }
  }
}));
```

## 6. 后端开发方案

### 6.1 路由结构

```javascript
// server/routes/templates.mjs
import express from 'express';
import { createClient } from '@supabase/supabase-js';
import { authenticateUser, requireAuth } from '../middleware/auth.mjs';
import { validateTemplate, validateComment } from '../middleware/validation.mjs';
import { uploadImage, uploadMultipleImages } from '../middleware/upload.mjs';

const router = express.Router();

// 公开接口
router.get('/templates', getTemplates);
router.get('/templates/:id', getTemplate);
router.get('/categories', getCategories);
router.get('/tags', getTags);

// 需要认证的接口
router.use(authenticateUser);

router.post('/templates', requireAuth, validateTemplate, uploadImage, createTemplate);
router.put('/templates/:id', requireAuth, validateTemplate, updateTemplate);
router.delete('/templates/:id', requireAuth, deleteTemplate);

router.post('/templates/:id/like', requireAuth, toggleLike);
router.post('/templates/:id/favorite', requireAuth, toggleFavorite);
router.post('/templates/:id/rating', requireAuth, rateTemplate);

router.get('/templates/:id/comments', getComments);
router.post('/templates/:id/comments', requireAuth, validateComment, addComment);

router.post('/templates/publish-from-task', requireAuth, publishFromTask);

// 用户相关
router.get('/user/templates', requireAuth, getUserTemplates);
router.get('/user/favorites', requireAuth, getUserFavorites);
router.get('/user/tasks', requireAuth, getUserTasks);

export default router;
```

### 6.2 核心控制器

```javascript
// server/controllers/templateController.mjs

// 获取模板列表
export const getTemplates = async (req, res) => {
  try {
    const {
      page = 1,
      limit = 20,
      category,
      tags,
      search,
      sort = 'popular',
      author,
      featured,
      premium
    } = req.query;

    let query = supabase
      .from('nb_templates')
      .select(`
        *,
        author:nb_user_profiles!author_id(username, avatar_url),
        category:nb_template_categories!category_id(name, name_en),
        tags:nb_template_tag_relations(
          nb_template_tags(id, name, color)
        )
      `)
      .eq('status', 'published');

    // 分类筛选
    if (category) {
      query = query.eq('category_id', category);
    }

    // 作者筛选
    if (author) {
      query = query.eq('author_id', author);
    }

    // 特色/付费筛选
    if (featured === 'true') {
      query = query.eq('is_featured', true);
    }
    if (premium === 'true') {
      query = query.eq('is_premium', true);
    }

    // 搜索
    if (search) {
      query = query.or(`
        title.ilike.%${search}%,
        description.ilike.%${search}%,
        prompt.ilike.%${search}%
      `);
    }

    // 排序
    switch (sort) {
      case 'latest':
        query = query.order('created_at', { ascending: false });
        break;
      case 'rating':
        query = query.order('rating_avg', { ascending: false });
        break;
      case 'downloads':
        query = query.order('download_count', { ascending: false });
        break;
      default: // popular
        query = query.order('like_count', { ascending: false });
    }

    // 分页
    const offset = (page - 1) * limit;
    query = query.range(offset, offset + limit - 1);

    const { data: templates, error, count } = await query;

    if (error) throw error;

    // 如果用户已登录，获取用户交互数据
    if (req.user) {
      const templateIds = templates.map(t => t.id);
      
      const [likesData, favoritesData, ratingsData] = await Promise.all([
        supabase
          .from('nb_user_likes')
          .select('template_id')
          .eq('user_id', req.user.id)
          .in('template_id', templateIds),
        supabase
          .from('nb_user_favorites')
          .select('template_id')
          .eq('user_id', req.user.id)
          .in('template_id', templateIds),
        supabase
          .from('nb_user_ratings')
          .select('template_id, rating')
          .eq('user_id', req.user.id)
          .in('template_id', templateIds)
      ]);

      const likedIds = new Set(likesData.data?.map(l => l.template_id) || []);
      const favoritedIds = new Set(favoritesData.data?.map(f => f.template_id) || []);
      const ratingsMap = new Map(
        ratingsData.data?.map(r => [r.template_id, r.rating]) || []
      );

      // 添加用户交互数据
      templates.forEach(template => {
        template.user_interaction = {
          is_liked: likedIds.has(template.id),
          is_favorited: favoritedIds.has(template.id),
          user_rating: ratingsMap.get(template.id)
        };
      });
    }

    res.json({
      success: true,
      data: {
        templates,
        total: count,
        page: parseInt(page),
        limit: parseInt(limit),
        hasMore: offset + templates.length < count
      }
    });

  } catch (error) {
    console.error('Get templates error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
};

// 创建模板
export const createTemplate = async (req, res) => {
  try {
    const {
      title,
      description,
      prompt,
      category_id,
      tags = [],
      difficulty_level = 1,
      estimated_time = 30,
      task_id
    } = req.body;

    const userId = req.user.id;
    
    // 上传封面图片
    let cover_image_url = null;
    if (req.files?.cover_image) {
      const uploadResult = await uploadToStorage(
        req.files.cover_image,
        `templates/${userId}/covers`
      );
      cover_image_url = uploadResult.url;
    }

    // 上传示例图片
    let example_images = [];
    if (req.files?.example_images) {
      const uploadPromises = req.files.example_images.map(file =>
        uploadToStorage(file, `templates/${userId}/examples`)
      );
      const uploadResults = await Promise.all(uploadPromises);
      example_images = uploadResults.map(result => result.url);
    }

    // 如果是从任务创建，获取任务图片
    if (task_id) {
      const { data: task } = await supabase
        .from('nb_user_tasks')
        .select('original_image_url, processed_image_url')
        .eq('id', task_id)
        .eq('user_id', userId)
        .single();

      if (task) {
        if (!cover_image_url && task.processed_image_url) {
          cover_image_url = task.processed_image_url;
        }
        if (task.original_image_url) {
          example_images.unshift(task.original_image_url);
        }
      }
    }

    // 创建模板
    const { data: template, error } = await supabase
      .from('nb_templates')
      .insert({
        title,
        description,
        prompt,
        author_id: userId,
        category_id,
        cover_image_url,
        example_images,
        difficulty_level,
        estimated_time,
        status: 'pending' // 需要审核
      })
      .select()
      .single();

    if (error) throw error;

    // 添加标签关联
    if (tags.length > 0) {
      await addTemplateTags(template.id, tags);
    }

    // 如果是从任务创建，创建发布申请记录
    if (task_id) {
      await supabase
        .from('nb_template_publish_requests')
        .insert({
          user_id: userId,
          task_id,
          proposed_title: title,
          proposed_description: description,
          proposed_category_id: category_id,
          proposed_tags: tags,
          status: 'approved' // 自动批准，或设为pending等待审核
        });
    }

    res.json({
      success: true,
      data: {
        template_id: template.id,
        status: template.status,
        message: '模板创建成功，等待审核'
      }
    });

  } catch (error) {
    console.error('Create template error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
};

// 点赞/取消点赞
export const toggleLike = async (req, res) => {
  try {
    const { id: templateId } = req.params;
    const userId = req.user.id;

    // 检查是否已点赞
    const { data: existingLike } = await supabase
      .from('nb_user_likes')
      .select('id')
      .eq('user_id', userId)
      .eq('template_id', templateId)
      .single();

    let isLiked;
    if (existingLike) {
      // 取消点赞
      await supabase
        .from('nb_user_likes')
        .delete()
        .eq('id', existingLike.id);
      isLiked = false;
    } else {
      // 添加点赞
      await supabase
        .from('nb_user_likes')
        .insert({
          user_id: userId,
          template_id: templateId
        });
      isLiked = true;
    }

    // 获取最新点赞数
    const { data: template } = await supabase
      .from('nb_templates')
      .select('like_count')
      .eq('id', templateId)
      .single();

    res.json({
      success: true,
      data: {
        is_liked: isLiked,
        like_count: template.like_count
      }
    });

  } catch (error) {
    console.error('Toggle like error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
};

// 从任务发布模板
export const publishFromTask = async (req, res) => {
  try {
    const {
      task_id,
      title,
      description,
      category_id,
      tags = []
    } = req.body;

    const userId = req.user.id;

    // 验证任务是否属于当前用户且成功
    const { data: task, error: taskError } = await supabase
      .from('nb_user_tasks')
      .select('*')
      .eq('id', task_id)
      .eq('user_id', userId)
      .eq('is_successful', true)
      .single();

    if (taskError || !task) {
      return res.status(404).json({
        success: false,
        error: '任务不存在或未成功完成'
      });
    }

    // 检查是否已经发布过
    const { data: existingRequest } = await supabase
      .from('nb_template_publish_requests')
      .select('id, status')
      .eq('task_id', task_id)
      .single();

    if (existingRequest) {
      return res.status(400).json({
        success: false,
        error: '该任务已经提交过发布申请'
      });
    }

    // 创建发布申请
    const { data: request, error } = await supabase
      .from('nb_template_publish_requests')
      .insert({
        user_id: userId,
        task_id,
        proposed_title: title,
        proposed_description: description,
        proposed_category_id: category_id,
        proposed_tags: tags,
        status: 'pending'
      })
      .select()
      .single();

    if (error) throw error;

    res.json({
      success: true,
      data: {
        request_id: request.id,
        status: 'pending',
        message: '发布申请已提交，等待管理员审核'
      }
    });

  } catch (error) {
    console.error('Publish from task error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
};
```

### 6.3 管理后台控制器

```javascript
// server/controllers/adminController.mjs

// 获取待审核模板
export const getPendingTemplates = async (req, res) => {
  try {
    const { page = 1, limit = 20 } = req.query;

    const { data: templates, error } = await supabase
      .from('nb_templates')
      .select(`
        *,
        author:nb_user_profiles!author_id(username, avatar_url),
        category:nb_template_categories!category_id(name)
      `)
      .eq('status', 'pending')
      .order('created_at', { ascending: false })
      .range((page - 1) * limit, page * limit - 1);

    if (error) throw error;

    res.json({
      success: true,
      data: { templates }
    });

  } catch (error) {
    console.error('Get pending templates error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
};

// 审核模板
export const reviewTemplate = async (req, res) => {
  try {
    const { id: templateId } = req.params;
    const { action, notes } = req.body; // approve | reject
    const adminId = req.user.id;

    const status = action === 'approve' ? 'published' : 'rejected';
    const published_at = action === 'approve' ? new Date().toISOString() : null;

    const { data: template, error } = await supabase
      .from('nb_templates')
      .update({
        status,
        published_at,
        reviewed_by: adminId,
        reviewed_at: new Date().toISOString(),
        review_notes: notes
      })
      .eq('id', templateId)
      .select()
      .single();

    if (error) throw error;

    // 如果批准，更新作者统计
    if (action === 'approve') {
      await supabase.rpc('increment_user_template_count', {
        user_id: template.author_id
      });
    }

    res.json({
      success: true,
      data: {
        template_id: templateId,
        status,
        message: `模板已${action === 'approve' ? '批准' : '拒绝'}`
      }
    });

  } catch (error) {
    console.error('Review template error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
};

// 数据分析
export const getAnalytics = async (req, res) => {
  try {
    const { period = '7d', metric = 'views' } = req.query;
    
    const days = period === '7d' ? 7 : period === '30d' ? 30 : 90;
    const startDate = new Date();
    startDate.setDate(startDate.getDate() - days);

    let query;
    switch (metric) {
      case 'views':
        query = supabase
          .from('nb_template_usage_logs')
          .select('template_id, created_at')
          .eq('action', 'view')
          .gte('created_at', startDate.toISOString());
        break;
      case 'downloads':
        query = supabase
          .from('nb_template_usage_logs')
          .select('template_id, created_at')
          .eq('action', 'download')
          .gte('created_at', startDate.toISOString());
        break;
      case 'likes':
        query = supabase
          .from('nb_user_likes')
          .select('template_id, created_at')
          .gte('created_at', startDate.toISOString());
        break;
      default:
        throw new Error('Invalid metric');
    }

    const { data: logs, error } = await query;
    if (error) throw error;

    // 按日期分组统计
    const dailyStats = {};
    logs.forEach(log => {
      const date = log.created_at.split('T')[0];
      dailyStats[date] = (dailyStats[date] || 0) + 1;
    });

    // 按模板分组统计
    const templateStats = {};
    logs.forEach(log => {
      templateStats[log.template_id] = (templateStats[log.template_id] || 0) + 1;
    });

    res.json({
      success: true,
      data: {
        daily_stats: dailyStats,
        template_stats: templateStats,
        total: logs.length
      }
    });

  } catch (error) {
    console.error('Get analytics error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
};
```

## 7. 实施计划

### 7.1 开发阶段

#### 第一阶段：基础架构（2周）
- [ ] 数据库表结构创建
- [ ] 基础API接口开发
- [ ] 用户认证和权限系统
- [ ] 文件上传功能

#### 第二阶段：核心功能（3周）
- [ ] 模板CRUD操作
- [ ] 模板搜索和筛选
- [ ] 用户互动功能（点赞、收藏、评分）
- [ ] 评论系统

#### 第三阶段：高级功能（2周）
- [ ] 从任务发布模板
- [ ] 管理后台
- [ ] 数据统计和分析
- [ ] 推荐算法

#### 第四阶段：优化完善（1周）
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 测试和修复
- [ ] 文档完善

### 7.2 技术要求

#### 后端技术栈
- Node.js + Express
- Supabase (PostgreSQL)
- JWT 认证
- Multer 文件上传
- Redis 缓存（可选）

#### 前端技术栈
- React 19 + TypeScript
- Zustand 状态管理
- React Query 数据获取
- Tailwind CSS 样式
- React Hook Form 表单

#### 部署要求
- 服务器：EC2 实例
- 数据库：Supabase
- 文件存储：Supabase Storage 或 AWS S3
- CDN：CloudFront（可选）

### 7.3 预期效果

#### 用户价值
1. **提高效率**：快速找到合适的提示词模板
2. **降低门槛**：新手也能使用专业级提示词
3. **激发创意**：通过优质模板启发创作灵感
4. **社区互动**：与其他创作者交流学习

#### 商业价值
1. **用户粘性**：丰富的内容生态增加用户留存
2. **变现机会**：付费模板、创作者分成
3. **数据价值**：用户行为数据指导产品优化
4. **品牌影响**：打造专业的AI创作平台形象

这个方案提供了完整的NB提示词模板库设计，包括数据库架构、API接口、前端组件和实施计划。可以根据实际需求进行调整和优化。

